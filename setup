# Setup omni integrators workbench environment

echo "Running on $(uname)"

if [ "$OS" == "Windows_NT" ]; then

   # Add a script to get to ism
   if [ ! -f "$HOMEDRIVE$HOMEPATH\Desktop\ismShell.lnk" ]; then
      cat > CreateShortcut.vbs << EOF
      Set oWS = WScript.CreateObject("WScript.Shell")
      Set oLink = oWS.CreateShortcut("$HOMEDRIVE$HOMEPATH\Desktop\ismShell.lnk")
      oLink.TargetPath = "$PROGRAMFILES\Git\bin\sh.exe"
      oLink.Arguments="--login -i ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $(boot2docker ip):9022"
      oLink.WorkingDirectory ="$HOMEDRIVE$HOMEPATH\omnidock"
      oLink.Save
EOF
      cscript //nologo CreateShortcut.vbs
      rm CreateShortcut.vbs
   fi

   # Create Shortcut to working dir
   if [ ! -f "$HOMEDRIVE$HOMEPATH\Desktop\Omni Integrators WorkBench.lnk" ]; then
      cat >  CreateShortcut.vbs << EOF
      Set oWS = WScript.CreateObject("WScript.Shell")
      Set oLink = oWS.CreateShortcut("$HOMEDRIVE$HOMEPATH\Desktop\Omni Integrators WorkBench.lnk")
      oLink.TargetPath = "$SYSTEMROOT\explorer.exe"
      oLink.Arguments="$HOMEDRIVE$HOMEPATH\omnidock\ism\OmniPatient"
      oLink.Save
EOF
      cscript //nologo CreateShortcut.vbs
      rm CreateShortcut.vbs
   fi

else
   OS=$(uname)   
fi


boot2docker version 2>/dev/null

if [ ! "$OS" == "Linux" ]; then
   echo
   boot2docker init
   boot2docker start
   boot2docker ip

   #override if $1 not empty 
   linkod="ln -f -s $HOME/omnidock omnidock"
   if [ ! "$1" == "" ]; then linkod="ln -f -s $1 omnidock";fi
   
   echo "$linkod"
   boot2docker ssh "$linkod"
   
   boot2docker ssh
fi
echo

